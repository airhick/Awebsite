import{r as i,j as e,s as N}from"./index-BaJPAlfg.js";import{H as b,T as v,P as y}from"./profile-dropdown-CWn5BkYL.js";import{M as w}from"./main-DB5M4M6V.js";import{T as C,P as S,L as k}from"./language-selector-DYo6sISo.js";import{C as m,a as d}from"./card-L9uDuaKz.js";import{B as c}from"./badge-BJdfDLGc.js";import{g as D}from"./translations-vJP4C5K3.js";import{S as _}from"./scroll-area-9WM68LTy.js";import{c as I,S as L}from"./satisfaction-score-BS8piwgN.js";import{P as A}from"./phone-B21hC69G.js";import{L as P}from"./loader-circle-oUm8UrHw.js";import{C as T}from"./zap-CcP7ecdL.js";import{M as E}from"./message-square-BRxbk9ZZ.js";import"./index-DcC8vhtZ.js";import"./index-DuaAHGFq.js";import"./sign-out-dialog-CzrWOUws.js";import"./index-CBR02F6j.js";import"./index-F8ZCAp3D.js";import"./index-COJurP2d.js";import"./index-BcP4i16F.js";import"./x-BfsncT4k.js";import"./index-DlOhfd2E.js";import"./index-Cp1JC4f4.js";import"./index-CwOgPF0w.js";import"./index-Cvx2jEXc.js";import"./check-CaqAlQp7.js";import"./chevron-right-bokZjX57.js";import"./sun-CiqfGljd.js";import"./menu-PcDCOOUr.js";import"./index-BdQq_4o_.js";import"./dialog-ByMEDLpT.js";const M=[{title:"Dashboard",href:"/dashboard",isActive:!1},{title:"Webhook",href:"/webhook",isActive:!0}];function W(){const[a,l]=i.useState([]),[x,u]=i.useState(!0),o=i.useRef(null);i.useEffect(()=>{const s=D();o.current=s},[]),i.useEffect(()=>{(async()=>{const t=o.current;if(!t){u(!1);return}try{const{data:r,error:n}=await N.from("call_logs").select("*").eq("customer_id",t).order("started_at",{ascending:!1,nullsFirst:!1}).order("created_at_db",{ascending:!1}).limit(100);n?(console.error("[WebhookDashboard] Error loading calls:",n),l([])):(console.log(`[WebhookDashboard] Loaded ${r?.length||0} calls for customer ${t}`),l(r||[]))}catch(r){console.error("[WebhookDashboard] Error loading calls:",r),l([])}finally{u(!1)}})()},[]);const h=s=>{if(!s)return"0s";const t=Math.floor(s/60),r=s%60;return t>0?`${t}m ${r}s`:`${r}s`},f=s=>{if(!s)return"Unknown date";try{return new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return s}},p=s=>s?Array.isArray(s)?s.map(t=>t.content||t.text||JSON.stringify(t)).join(`
`):typeof s=="string"?s:s.content?s.content:JSON.stringify(s):"No transcript available",j=i.useMemo(()=>{const s={};return a.forEach(t=>{s[t.id]=I(t)}),s},[a]);return e.jsxs(e.Fragment,{children:[e.jsxs(b,{children:[e.jsx(C,{links:M}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(S,{}),e.jsx(k,{}),e.jsx(v,{}),e.jsx(y,{})]})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Incoming Calls"}),e.jsx("p",{className:"text-muted-foreground",children:"Past calls where users requested to be transferred to a human agent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o.current&&e.jsxs(c,{variant:"outline",children:["Customer ID: ",o.current]}),a.length>0&&e.jsxs(c,{variant:"secondary",children:[a.length," call",a.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),e.jsx("h2",{className:"text-xl font-bold",children:"Previous Calls"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All calls handled by your AI assistants, including transcript, summary, duration, and timestamps."}),x?e.jsx(m,{children:e.jsx(d,{className:"flex items-center justify-center py-12",children:e.jsx(P,{className:"h-6 w-6 animate-spin text-muted-foreground"})})}):a.length===0?e.jsx(m,{children:e.jsx(d,{className:"text-center py-12 text-muted-foreground italic border-dashed",children:"No calls found yet. Calls will appear here once they are synced to the database."})}):e.jsx("div",{className:"space-y-4",children:a.map(s=>{const t=p(s.transcript),r=s.summary||"No summary available",n=h(s.duration),g=f(s.started_at||s.created_at_db);return e.jsxs(m,{className:"overflow-hidden",children:[e.jsx("div",{className:"border-b bg-muted/50 p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsx(c,{variant:s.status==="ended"?"default":"destructive",children:s.status||"Unknown"}),s.assistant_id&&e.jsxs(c,{variant:"outline",className:"font-mono text-xs",children:[s.assistant_id.substring(0,8),"..."]}),e.jsx("div",{className:"ml-auto",children:e.jsx(L,{score:j[s.id]??50,size:50,transcript:t,summary:s.summary||void 0,interactive:!0})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),e.jsx("span",{children:g})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{children:["Duration: ",n]})})]})]})})}),e.jsxs(d,{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(E,{className:"h-4 w-4 text-primary"}),e.jsx("h4",{className:"text-sm font-semibold",children:"AI Summary"})]}),e.jsx("div",{className:"bg-muted/50 p-3 rounded-lg",children:e.jsx("p",{className:"text-sm",children:r})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Transcript"}),e.jsx(_,{className:"h-[200px] w-full rounded-md border p-4 bg-muted/30",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t})})]})]})]},s.id)})})]})]})})]})}const he=W;export{he as component};
