import{c as U,r as d,j as e,b as X,s as Y,a as M,L as _,t as g,g as Z,d as ee,O as se}from"./index-Dmc57Mdn.js";import{u as te,s as ae,S as ne,L as re}from"./search-provider-Dyds0UyP.js";import{u as N,S as oe,a as ie,b as O,c as f,d as j,e as le,D as B,f as G,g as H,h as z,i as q,j as J,k as ce,l as de,m as ue,n as pe,A as w,o as k,p as F,q as he,r as xe,s as me,t as ge,v as fe,w as je,x as be,y as ve}from"./sign-out-dialog-CN_iIeYx.js";import{u as Ce}from"./useLocation-BND7kaBt.js";import{u as Ne,c as ye,P as D,a as Se,b as we}from"./index-Vt8IWMHl.js";import{P as ke}from"./index-Bs9hS0rY.js";import{u as Me}from"./index-DJm5tJ8n.js";import{B as Oe}from"./badge-C6pX3pzQ.js";import{L as _e}from"./loader-circle-nGlmUNKi.js";import{C as A}from"./chevron-right-C2F3MznX.js";import"./command-N0pSyddX.js";import"./index-BSQDBg4h.js";import"./index-Ct_9EG-d.js";import"./dialog-Cpbspn4M.js";import"./x-BV3mEE3d.js";import"./scroll-area-BMbv0Ugo.js";import"./index-BdQq_4o_.js";import"./sun-DSrFnZKJ.js";import"./index-3x_-me6U.js";import"./index-p71i3FAo.js";import"./index-DIXBHiU-.js";import"./index-xomcKHAZ.js";import"./index-DOckRwat.js";import"./check-tW8F_RW7.js";const De=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Ae=U("chevrons-up-down",De);const Pe=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Re=U("log-out",Pe);var y="Collapsible",[Le]=ye(y),[Ee,P]=Le(y),V=d.forwardRef((s,n)=>{const{__scopeCollapsible:a,open:t,defaultOpen:o,disabled:r,onOpenChange:i,...h}=s,[l,c]=Ne({prop:t,defaultProp:o??!1,onChange:i,caller:y});return e.jsx(Ee,{scope:a,disabled:r,contentId:Me(),open:l,onOpenToggle:d.useCallback(()=>c(x=>!x),[c]),children:e.jsx(D.div,{"data-state":L(l),"data-disabled":r?"":void 0,...h,ref:n})})});V.displayName=y;var W="CollapsibleTrigger",K=d.forwardRef((s,n)=>{const{__scopeCollapsible:a,...t}=s,o=P(W,a);return e.jsx(D.button,{type:"button","aria-controls":o.contentId,"aria-expanded":o.open||!1,"data-state":L(o.open),"data-disabled":o.disabled?"":void 0,disabled:o.disabled,...t,ref:n,onClick:Se(s.onClick,o.onOpenToggle)})});K.displayName=W;var R="CollapsibleContent",Q=d.forwardRef((s,n)=>{const{forceMount:a,...t}=s,o=P(R,s.__scopeCollapsible);return e.jsx(ke,{present:a||o.open,children:({present:r})=>e.jsx($e,{...t,ref:n,present:r})})});Q.displayName=R;var $e=d.forwardRef((s,n)=>{const{__scopeCollapsible:a,present:t,children:o,...r}=s,i=P(R,a),[h,l]=d.useState(t),c=d.useRef(null),x=X(n,c),u=d.useRef(0),m=u.current,E=d.useRef(0),$=E.current,S=i.open||h,I=d.useRef(S),v=d.useRef(void 0);return d.useEffect(()=>{const p=requestAnimationFrame(()=>I.current=!1);return()=>cancelAnimationFrame(p)},[]),we(()=>{const p=c.current;if(p){v.current=v.current||{transitionDuration:p.style.transitionDuration,animationName:p.style.animationName},p.style.transitionDuration="0s",p.style.animationName="none";const T=p.getBoundingClientRect();u.current=T.height,E.current=T.width,I.current||(p.style.transitionDuration=v.current.transitionDuration,p.style.animationName=v.current.animationName),l(t)}},[i.open,t]),e.jsx(D.div,{"data-state":L(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!S,...r,ref:x,style:{"--radix-collapsible-content-height":m?`${m}px`:void 0,"--radix-collapsible-content-width":$?`${$}px`:void 0,...s.style},children:S&&o})});function L(s){return s?"open":"closed"}var Ie=V;const Te=Ie,Fe=K,Ue=Q;async function Be(s,n){try{const o="https://oknakvgnwxlkvhwmocno.supabase.co/functions/v1/n8n-webhook",r=[{valeur:s,body:n}],i=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(await Y.auth.getSession()).data.session?.access_token||""}`},body:JSON.stringify(r)});if(!i.ok){const l=await i.json().catch(()=>({error:"Unknown error"}));throw new Error(l.error||`HTTP error! status: ${i.status}`)}return{success:!0,message:(await i.json()).message}}catch(a){return console.error("Edge function error:",a),{success:!1,error:a.message||"Failed to call edge function"}}}function Ge({title:s,items:n}){const{state:a,isMobile:t}=N(),o=Ce({select:r=>r.href});return e.jsxs(oe,{children:[s&&e.jsx(ie,{children:s}),e.jsx(O,{children:n.map(r=>{const i=`${r.title}-${r.url}`;return r.items?a==="collapsed"&&!t?e.jsx(qe,{item:r,href:o},i):e.jsx(ze,{item:r,href:o},i):e.jsx(He,{item:r,href:o},i)})})]})}function C({children:s}){return e.jsx(Oe,{className:"rounded-full px-1 py-0 text-xs",children:s})}function He({item:s,href:n}){const{setOpenMobile:a}=N(),{user:t}=M(l=>l.auth),[o,r]=d.useState(!1),i=s.url==="/dashboard",h=async l=>{if(l.preventDefault(),l.stopPropagation(),!t){g.error("Please log in to use this feature");return}const c=localStorage.getItem("aurora_customer");let x=null;if(c)try{x=JSON.parse(c).id}catch(u){console.error("Failed to parse customer data:",u)}if(!x&&t.id&&(x=parseInt(t.id,10)),!x){g.error("Unable to identify customer ID");return}r(!0);try{const u={action:"dashboard_access",timestamp:new Date().toISOString(),user_id:t.id,email:t.email},m=await Be(x,u);m.success?g.success(m.message||"Event logged successfully"):g.error(m.error||"Failed to log event")}catch(u){console.error("Edge function error:",u),g.error(u.message||"Failed to call edge function")}finally{r(!1)}};return e.jsxs(f,{children:[e.jsx(j,{asChild:!0,isActive:b(n,s),tooltip:s.title,children:e.jsxs(_,{to:s.url,onClick:()=>a(!1),children:[s.icon&&e.jsx(s.icon,{}),e.jsx("span",{children:s.title}),s.badge&&e.jsx(C,{children:s.badge})]})}),i&&e.jsx(le,{onClick:h,disabled:o,showOnHover:!0,"aria-label":"Trigger edge function",children:o?e.jsx(_e,{className:"h-4 w-4 animate-spin"}):e.jsx(A,{className:"h-4 w-4"})})]})}function ze({item:s,href:n}){const{setOpenMobile:a}=N();return e.jsx(Te,{asChild:!0,defaultOpen:b(n,s,!0),className:"group/collapsible",children:e.jsxs(f,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(j,{tooltip:s.title,children:[s.icon&&e.jsx(s.icon,{}),e.jsx("span",{children:s.title}),s.badge&&e.jsx(C,{children:s.badge}),e.jsx(A,{className:"ms-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90 rtl:rotate-180"})]})}),e.jsx(Ue,{className:"CollapsibleContent",children:e.jsx(ce,{children:s.items.map(t=>e.jsx(de,{children:e.jsx(ue,{asChild:!0,isActive:b(n,t),children:e.jsxs(_,{to:t.url,onClick:()=>a(!1),children:[t.icon&&e.jsx(t.icon,{}),e.jsx("span",{children:t.title}),t.badge&&e.jsx(C,{children:t.badge})]})})},t.title))})})]})})}function qe({item:s,href:n}){return e.jsx(f,{children:e.jsxs(B,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(j,{tooltip:s.title,isActive:b(n,s),children:[s.icon&&e.jsx(s.icon,{}),e.jsx("span",{children:s.title}),s.badge&&e.jsx(C,{children:s.badge}),e.jsx(A,{className:"ms-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90"})]})}),e.jsxs(H,{side:"right",align:"start",sideOffset:4,children:[e.jsxs(z,{children:[s.title," ",s.badge?`(${s.badge})`:""]}),e.jsx(q,{}),s.items.map(a=>e.jsx(J,{asChild:!0,children:e.jsxs(_,{to:a.url,className:`${b(n,a)?"bg-secondary":""}`,children:[a.icon&&e.jsx(a.icon,{}),e.jsx("span",{className:"max-w-52 text-wrap",children:a.title}),a.badge&&e.jsx("span",{className:"ms-auto text-xs",children:a.badge})]})},`${a.title}-${a.url}`))]})]})})}function b(s,n,a=!1){return s===n.url||s.split("?")[0]===n.url||!!n?.items?.filter(t=>t.url===s).length||a&&s.split("/")[1]!==""&&s.split("/")[1]===n?.url?.split("/")[1]}function Je(){const{isMobile:s}=N(),[n,a]=pe(),t=M(c=>c.auth.user),{signInWithGoogle:o}=M(c=>c.auth),r=t?.user_metadata?.full_name||t?.user_metadata?.name||t?.email?.split("@")[0]||"User",i=t?.email||"",h=t?.user_metadata?.avatar_url||"",l=r.split(" ").map(c=>c[0]).join("").toUpperCase().slice(0,2)||"U";return t?e.jsxs(e.Fragment,{children:[e.jsx(O,{children:e.jsx(f,{children:e.jsxs(B,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(j,{size:"lg",className:"data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",children:[e.jsxs(w,{className:"h-8 w-8 rounded-lg",children:[e.jsx(F,{src:h,alt:r}),e.jsx(k,{className:"rounded-lg",children:l})]}),e.jsxs("div",{className:"grid flex-1 text-start text-sm leading-tight",children:[e.jsx("span",{className:"truncate font-semibold",children:r}),e.jsx("span",{className:"truncate text-xs",children:i})]}),e.jsx(Ae,{className:"ms-auto size-4"})]})}),e.jsxs(H,{className:"w-(--radix-dropdown-menu-trigger-width) min-w-56 rounded-lg",side:s?"bottom":"right",align:"end",sideOffset:4,children:[e.jsx(z,{className:"p-0 font-normal",children:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1.5 text-start text-sm",children:[e.jsxs(w,{className:"h-8 w-8 rounded-lg",children:[e.jsx(F,{src:h,alt:r}),e.jsx(k,{className:"rounded-lg",children:l})]}),e.jsxs("div",{className:"grid flex-1 text-start text-sm leading-tight",children:[e.jsx("span",{className:"truncate font-semibold",children:r}),e.jsx("span",{className:"truncate text-xs",children:i})]})]})}),e.jsx(q,{}),e.jsxs(J,{className:"text-destructive focus:text-destructive",onClick:()=>a(!0),children:[e.jsx(Re,{}),"Sign out"]})]})]})})}),e.jsx(he,{open:!!n,onOpenChange:a})]}):e.jsx(O,{children:e.jsx(f,{children:e.jsxs(j,{size:"lg",onClick:()=>o(),className:"w-full",children:[e.jsx(w,{className:"h-8 w-8 rounded-lg",children:e.jsx(k,{className:"rounded-lg",children:"U"})}),e.jsxs("div",{className:"grid flex-1 text-start text-sm leading-tight",children:[e.jsx("span",{className:"truncate font-semibold",children:"Sign In"}),e.jsx("span",{className:"truncate text-xs",children:"Click to login"})]})]})})})}function Ve(){const{collapsible:s,variant:n}=te();return e.jsxs(xe,{collapsible:s,variant:n,children:[e.jsx(me,{children:e.jsx("div",{className:"logo",style:{fontSize:0,lineHeight:0},children:e.jsx("img",{src:"/logos/aurora-logo.png",alt:"Aurora Logo",className:"h-7 object-contain",style:{width:"auto",display:"block"}})})}),e.jsx(ge,{children:ae.navGroups.map((a,t)=>e.jsx(Ge,{...a},a.title||`nav-group-${t}`))}),e.jsx(fe,{children:e.jsx(Je,{})}),e.jsx(je,{})]})}function We(){return e.jsx("a",{className:"bg-primary text-primary-foreground hover:bg-primary/90 focus-visible:ring-ring fixed start-44 z-999 -translate-y-52 px-4 py-2 text-sm font-medium whitespace-nowrap opacity-95 shadow-sm transition focus:translate-y-3 focus:transform focus-visible:ring-1",href:"#content",children:"Skip to Main"})}function Ke({children:s}){const n=Z("sidebar_state")!=="false";return e.jsx(ne,{children:e.jsx(re,{children:e.jsxs(be,{defaultOpen:n,children:[e.jsx(We,{}),e.jsx(Ve,{}),e.jsx(ve,{className:ee("@container/content","has-data-[layout=fixed]:h-svh","peer-data-[variant=inset]:has-data-[layout=fixed]:h-[calc(100svh-(var(--spacing)*4))]"),children:s??e.jsx(se,{})})]})})})}const vs=Ke;export{vs as component};
