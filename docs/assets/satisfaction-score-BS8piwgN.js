import{r as v,j as t,d as C}from"./index-BaJPAlfg.js";import{T as I,B as A,E as F}from"./sign-out-dialog-CzrWOUws.js";import{D,a as P,b as E,c as R,d as $}from"./dialog-ByMEDLpT.js";import{L as O}from"./loader-circle-oUm8UrHw.js";async function _(e,s){try{const n=`You are an expert call quality analyst. Analyze the following customer service call and provide a detailed rating on a scale from 1 to 100.

${s?`Call Summary: ${s}

`:""}Call Transcript:
${e}

Please provide:
1. A numerical score from 1 to 100 (where 100 is excellent and 1 is very poor)
2. Detailed reasoning explaining your rating
3. Key strengths of the call
4. Areas for improvement

Respond in JSON format:
{
  "score": <number 1-100>,
  "reasoning": "<detailed explanation>",
  "strengths": ["<strength1>", "<strength2>"],
  "areasForImprovement": ["<area1>", "<area2>"]
}`;let i=null,c="";try{if(i=await fetch("https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:n,parameters:{max_new_tokens:500,temperature:.7,return_full_text:!1}})}),i.ok){const r=await i.json();if(c=Array.isArray(r)?r[0]?.generated_text||"":r.generated_text||"",r.error&&r.error.includes("loading"))throw new Error("Model is loading")}else throw new Error(`HTTP ${i.status}`)}catch(r){return console.warn("Hugging Face API failed, trying fallback:",r),j(e,s)}if(!c)return j(e,s);const d=c.match(/\{[\s\S]*\}/);if(d)try{const r=JSON.parse(d[0]);return{score:Math.max(1,Math.min(100,Math.round(r.score||50))),reasoning:r.reasoning||"Analysis completed",strengths:r.strengths||[],areasForImprovement:r.areasForImprovement||[]}}catch(r){console.warn("Failed to parse LLM JSON response",r)}const o=c.match(/score["\s:]*(\d+)/i)||c.match(/(\d+)\s*(?:out of|from|on a scale)/i),f=o?parseInt(o[1],10):null;return{score:f?Math.max(1,Math.min(100,f)):50,reasoning:c.substring(0,500)||"LLM analysis completed",strengths:[],areasForImprovement:[]}}catch(n){return console.error("Error calling LLM API:",n),j(e,s)}}function j(e,s){const n=`${s||""} ${e}`.toLowerCase();let i=50;const d=[/\b(thank you|thanks|appreciate|great|excellent|perfect|wonderful|amazing|helpful|satisfied|happy|pleased|resolved|solved|fixed|understood|clear)\b/gi].reduce((r,a)=>{const u=n.match(a);return r+(u?u.length:0)},0),f=[/\b(frustrated|angry|upset|disappointed|terrible|awful|horrible|useless|confused|broken|wrong|incorrect|problem|issue|error|failed|bad|poor)\b/gi].reduce((r,a)=>{const u=n.match(a);return r+(u?u.length:0)},0);return i+=d*3,i-=f*5,i=Math.max(1,Math.min(100,i)),{score:Math.round(i),reasoning:`Based on keyword analysis: Found ${d} positive indicators and ${f} negative indicators.`,strengths:d>0?["Positive customer interactions detected"]:[],areasForImprovement:f>0?["Some negative sentiment detected"]:[]}}function W({score:e,size:s=60,className:n,showLabel:i=!1,transcript:c,summary:d,interactive:o=!1}){const[f,r]=v.useState(!1),[a,u]=v.useState(null),[m,w]=v.useState(!1),h=Math.max(0,Math.min(100,e)),p=(l=>l>=80?"#10b981":l>=60?"#3b82f6":l>=40?"#f59e0b":"#ef4444")(h),g=(s-8)/2,x=2*Math.PI*g,k=x-h/100*x,M=async()=>{if(!(!o||!c)&&(r(!0),!a)){w(!0);try{const l=await _(c,d);u(l)}catch(l){console.error("Failed to get detailed rating:",l)}finally{w(!1)}}},S=l=>l>=80?"Excellent":l>=60?"Good":l>=40?"Moderate":"Poor",b=t.jsxs("div",{className:C("relative inline-flex items-center justify-center",o&&c&&"cursor-pointer hover:opacity-80 transition-opacity",n),onClick:M,children:[t.jsxs("svg",{width:s,height:s,className:"transform -rotate-90",children:[t.jsx("circle",{cx:s/2,cy:s/2,r:g,stroke:"currentColor",strokeWidth:"4",fill:"none",className:"text-muted"}),t.jsx("circle",{cx:s/2,cy:s/2,r:g,stroke:p,strokeWidth:"4",fill:"none",strokeDasharray:x,strokeDashoffset:k,strokeLinecap:"round",className:"transition-all duration-500 ease-in-out"})]}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("span",{className:"text-sm font-bold",style:{color:p},children:Math.round(h)})}),i&&t.jsx("div",{className:"absolute -bottom-5 left-1/2 transform -translate-x-1/2 text-xs text-muted-foreground whitespace-nowrap",children:"Satisfaction"})]});return o&&c?t.jsxs(t.Fragment,{children:[t.jsxs(I,{children:[t.jsx(A,{asChild:!0,children:b}),t.jsx(F,{children:t.jsx("p",{children:"Click for detailed rating analysis"})})]}),t.jsx(D,{open:f,onOpenChange:r,children:t.jsxs(P,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[t.jsxs(E,{children:[t.jsx(R,{children:"Detailed Call Rating Analysis"}),t.jsx($,{children:"AI-powered analysis of call quality and customer satisfaction"})]}),m?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx(O,{className:"h-6 w-6 animate-spin text-muted-foreground"}),t.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:"Analyzing call..."})]}):a?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"text-4xl font-bold",style:{color:p},children:a.score}),t.jsxs("div",{children:[t.jsx("div",{className:"text-lg font-semibold",children:S(a.score)}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Out of 100"})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2",children:"Reasoning"}),t.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:a.reasoning})]}),a.strengths&&a.strengths.length>0&&t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2 text-green-600",children:"Strengths"}),t.jsx("ul",{className:"list-disc list-inside space-y-1",children:a.strengths.map((l,y)=>t.jsx("li",{className:"text-sm text-muted-foreground",children:l},y))})]}),a.areasForImprovement&&a.areasForImprovement.length>0&&t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2 text-orange-600",children:"Areas for Improvement"}),t.jsx("ul",{className:"list-disc list-inside space-y-1",children:a.areasForImprovement.map((l,y)=>t.jsx("li",{className:"text-sm text-muted-foreground",children:l},y))})]})]}):t.jsx("div",{className:"text-sm text-muted-foreground",children:"Click the gauge to load detailed analysis"})]})})]}):b}function q(e){let s="";return e.transcript&&(Array.isArray(e.transcript)?s+=e.transcript.map(n=>n.content||n.text||JSON.stringify(n)).join(" "):typeof e.transcript=="string"?s+=e.transcript:e.transcript.content&&(s+=e.transcript.content)),e.messages&&(Array.isArray(e.messages)?s+=" "+e.messages.map(n=>n.content||n.text||JSON.stringify(n)).join(" "):typeof e.messages=="string"&&(s+=" "+e.messages)),e.summary&&(s+=" "+e.summary),s=s.toLowerCase().trim(),s?N(s,e.ended_reason):50}function N(e,s){const n=["thank you","thanks","appreciate","great","excellent","perfect","wonderful","amazing","helpful","satisfied","happy","pleased","love it","exactly what","perfect solution","very good","good job","exactly","yes please","that works","sounds good","perfect","resolved","solved","fixed","understood","clear","makes sense"],i=["frustrated","angry","upset","disappointed","terrible","awful","horrible","useless","waste of time","not helpful","confused","doesn't work","broken","wrong","incorrect","no idea","unclear","complicated","difficult","problem","issue","error","failed","can't","cannot","won't work","not working","bad","poor"];let c=0,d=0;n.forEach(a=>{const u=new RegExp(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),m=e.match(u);m&&(c+=m.length)}),i.forEach(a=>{const u=new RegExp(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),m=e.match(u);m&&(d+=m.length)});let o=50;o+=c*5,o-=d*8,[/(?:rate|rating|satisfaction|satisfied|happy).*?(?:1|2|3|4|5|one|two|three|four|five|excellent|good|bad|poor)/gi,/(?:how.*?service|how.*?help|how.*?experience)/gi].forEach(a=>{a.test(e)&&(e.includes("excellent")||e.includes("5")||e.includes("five")?o+=20:e.includes("good")||e.includes("4")||e.includes("four")?o+=10:(e.includes("bad")||e.includes("poor")||e.includes("1")||e.includes("one"))&&(o-=30))});const r=s?.toLowerCase()||"";return(r.includes("transfer")||r.includes("forward"))&&(o-=15),(e.includes("resolved")||e.includes("solved")||e.includes("fixed"))&&(o+=10),o=Math.max(0,Math.min(100,o)),Math.round(o)}function G(e){const s=[...e.transcript||[],...e.messages||[]];if(s.length===0)return 50;const n=s.map(i=>i.content||"").join(" ").toLowerCase();return n.trim()?N(n,e.endedReason):50}export{W as S,G as a,q as c};
