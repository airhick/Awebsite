import{c as T,a as P,r as x,j as s,B as z}from"./index-AZRKLprC.js";import{C as w,b,c as C,a as S}from"./card-D-HpVhxM.js";import{u as R}from"./use-vapi-calls-GnRdGFRM.js";import{B as k}from"./badge-Do_GTGR9.js";import{u as H}from"./translations-wzrxUbv4.js";import{D as V,a as q,b as U,c as G,d as K}from"./dialog-DtUMgEud.js";import{S as f}from"./scroll-area-qCv1299V.js";import{z as o}from"./sign-out-dialog-AnFhJCRA.js";import{a as A,S as D}from"./satisfaction-score-DvxnD-rd.js";import{X as O}from"./x-BuDuKc4e.js";import{E as X}from"./eye-DGgA0lO4.js";import{M as I}from"./message-square-CRwJ4aSr.js";import"./dashboard-wMEN_5dC.js";import"./profile-dropdown-BTULBhDv.js";import"./index-DNsUMHwo.js";import"./index-BJWCgvxH.js";import"./sun-0woIss2Q.js";import"./check-VvZRUagb.js";import"./main-BsbTCWwG.js";import"./language-selector-B1xoLwrN.js";import"./menu-D5SL0Ff1.js";import"./zap-CP_aG4uh.js";import"./phone-DVlX5ywO.js";import"./business-setup-Cqx3vc7s.js";import"./index-BxR81DGy.js";import"./index-x2k7BnSB.js";import"./label-D12cn_zP.js";import"./alert-OtaKXM0w.js";import"./mail-D42ns7v9.js";import"./index-vXKUGHp-.js";import"./index-KK7hgHi3.js";import"./index-BdQq_4o_.js";import"./index-CoRew2K6.js";import"./index-Mb5F2CX-.js";import"./index-U0HMoaUJ.js";import"./index-DYKePuJ9.js";import"./chevron-right-Bu9YosSK.js";import"./loader-circle-BluJhsme.js";const J=[["path",{d:"M16 2v6h6",key:"1mfrl5"}],["path",{d:"m22 2-6 6",key:"6f0sa0"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],j=T("phone-incoming",J);const Q=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],y=T("refresh-cw",Q),W="https://api.vapi.ai";async function M(h,p){const c=await fetch(`${W}/call/${p}`,{headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}});if(!c.ok)throw new Error("Failed to fetch call details");return await c.json()}function Bs(){const{calls:h,loading:p}=R(),c=P(e=>e.auth.user),i=H(),[t,g]=x.useState(null),[_,N]=x.useState(!1),[n,m]=x.useState({}),d=c?.user_metadata?.vapi_api_key||localStorage.getItem("vapi_private_key")||"",l=h.filter(e=>e.type==="inboundPhoneCall").slice(0,10),E=x.useMemo(()=>{const e={};return l.forEach(a=>{e[a.id]=A(a)}),e},[l]),L=e=>e?new Date(e).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",v=e=>{let a="";return e.transcript&&(Array.isArray(e.transcript)?a=e.transcript.map(r=>r.content||r.text||"").join(" "):typeof e.transcript=="string"?a=e.transcript:e.transcript.content&&(a=e.transcript.content)),!a&&e.messages&&(Array.isArray(e.messages)?a=e.messages.map(r=>r.content||r.text||"").join(" "):typeof e.messages=="string"&&(a=e.messages)),a.trim()},$=async e=>{if(d){N(!0);try{const a=await M(d,e);g(a)}catch(a){console.error("Failed to load call detail:",a)}finally{N(!1)}}},B=async(e,a)=>{if(a.stopPropagation(),n[e.id]){const r={...n};delete r[e.id],m(r);return}if(d){m({...n,[e.id]:{callId:e.id,summary:"",loading:!0}});try{const u=(await M(d,e.id)).analysis?.summary||i.calls.noSummary;m({...n,[e.id]:{callId:e.id,summary:u,loading:!1}})}catch(r){console.error("Failed to load call summary:",r),m({...n,[e.id]:{callId:e.id,summary:i.calls.failedToLoad,loading:!1}})}}};return p&&l.length===0?s.jsxs(w,{children:[s.jsx(b,{children:s.jsxs(C,{className:"flex items-center gap-2",children:[s.jsx(j,{className:"h-5 w-5"}),"Recent Incoming Calls"]})}),s.jsx(S,{children:s.jsx(f,{className:"h-[280px] w-full",children:s.jsx("div",{className:"space-y-2 pr-4",children:[1,2,3].map(e=>s.jsx("div",{className:"border rounded-lg p-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(o,{className:"h-4 w-4 rounded"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx(o,{className:"h-4 w-32"}),s.jsx(o,{className:"h-3 w-24"})]}),s.jsx(o,{className:"h-5 w-16 rounded-full"}),s.jsx(o,{className:"h-8 w-12 rounded"})]})},e))})})})]}):s.jsxs(s.Fragment,{children:[s.jsxs(w,{children:[s.jsx(b,{children:s.jsxs(C,{className:"flex items-center gap-2",children:[s.jsx(j,{className:"h-5 w-5"}),i.calls.recentCalls]})}),s.jsx(S,{children:l.length===0?s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s.jsx("p",{children:i.calls.previousCalls})}):s.jsx(f,{className:"h-[280px] w-full",children:s.jsx("div",{className:"space-y-2 pr-4",children:l.map(e=>{const a=n[e.id],r=!!a,u=E[e.id]??50;return s.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-accent transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 cursor-pointer",onClick:()=>$(e.id),children:[s.jsx(j,{className:"h-4 w-4 text-blue-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:e.customer?.number||"Unknown number"}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:[L(e.startedAt||e.createdAt)," ",e.status==="ended"?i.calls.ended:""]})]}),s.jsx(D,{score:u,size:50,className:"mx-2",transcript:v(e),summary:e.analysis?.summary,interactive:!0}),s.jsx(k,{variant:e.status==="ended"?"default":"destructive",children:e.status})]}),s.jsx(z,{variant:"ghost",size:"sm",className:"ml-2 flex-shrink-0",onClick:F=>B(e,F),disabled:a?.loading,children:a?.loading?s.jsx(y,{className:"h-4 w-4 animate-spin"}):r?s.jsx(O,{className:"h-4 w-4"}):s.jsxs(s.Fragment,{children:[s.jsx(X,{className:"h-4 w-4 mr-1"}),i.calls.see]})})]}),r&&s.jsxs("div",{className:"border-t bg-muted/30 p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(I,{className:"h-4 w-4 text-primary"}),s.jsx("span",{className:"text-sm font-semibold",children:i.calls.callSummary})]}),a.loading?s.jsxs("div",{className:"flex items-center justify-center py-4",children:[s.jsx(y,{className:"h-5 w-5 animate-spin text-muted-foreground"}),s.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:i.calls.loadingSummary})]}):s.jsx(f,{className:"h-[200px] w-full",children:s.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:a.summary||i.calls.noSummary})})]})]},e.id)})})})})]}),s.jsx(V,{open:!!t,onOpenChange:()=>g(null),children:s.jsxs(q,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[s.jsxs(U,{children:[s.jsx(G,{children:"Call Details"}),s.jsx(K,{children:t?.id})]}),_?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(y,{className:"h-6 w-6 animate-spin"})}):t?s.jsxs("div",{className:"space-y-4 mt-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-1",children:"Status"}),s.jsx(k,{children:t.status})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-1",children:"Type"}),s.jsx("p",{className:"text-sm",children:t.type})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-1",children:"Duration"}),s.jsx("p",{className:"text-sm",children:t.duration?`${Math.floor(t.duration/60)}m ${t.duration%60}s`:"-"})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-1",children:"Cost"}),s.jsxs("p",{className:"text-sm",children:["$",t.cost?.toFixed(4)||"0.0000"]})]}),s.jsxs("div",{className:"col-span-2",children:[s.jsx("h4",{className:"font-semibold mb-2",children:"Customer Satisfaction"}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(D,{score:A(t),size:80,showLabel:!0,transcript:v(t),summary:t.analysis?.summary,interactive:!0}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Score calculated from transcript analysis. Click for detailed AI analysis."})]})]})]}),t.analysis?.summary&&s.jsxs("div",{children:[s.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[s.jsx(I,{className:"h-4 w-4"}),"Summary"]}),s.jsx("p",{className:"text-sm bg-muted p-3 rounded-lg",children:t.analysis.summary})]}),t.messages&&t.messages.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-2",children:"Messages"}),s.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:t.messages.map((e,a)=>s.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[s.jsx("div",{className:"text-xs font-medium mb-1",children:e.role}),s.jsx("div",{className:"text-sm",children:e.content}),e.toolCalls&&e.toolCalls.length>0&&s.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:["Tools: ",e.toolCalls.map(r=>r.function.name).join(", ")]})]},a))})]})]}):null]})})]})}export{Bs as CallDetails};
