import{r as a}from"./index-BaJPAlfg.js";import{g as u}from"./dashboard-4SNQH-46.js";import{g as d}from"./translations-vJP4C5K3.js";function f(e){return{id:e.vapi_call_id,status:e.status||"unknown",type:e.type||"unknown",startedAt:e.started_at||void 0,createdAt:e.created_at_db||void 0,duration:e.duration||void 0,endedReason:e.ended_reason||void 0,messages:e.messages||void 0,transcript:e.transcript||void 0,assistantId:e.assistant_id||void 0,artifact:void 0}}function _(){const[e,l]=a.useState([]),[m,o]=a.useState(!1),[g,r]=a.useState(null),i=a.useRef(!1);a.useEffect(()=>{(async()=>{const s=d();if(!s){l([]);return}o(!0),r(null);try{const p=(await u(s,1e3)).map(f);l(p)}catch(t){t.code==="PGRST205"||t.message?.includes("call_logs")?r("call_logs table does not exist. Please run supabase-call-logs-schema.sql"):(console.error("Error loading calls from DB:",t),r(t.message||"Failed to load calls")),l([])}finally{o(!1)}})()},[]);const n=a.useCallback(async()=>{if(i.current)return;const c=d();if(!c){l([]);return}i.current=!0,o(!0),r(null);try{const t=(await u(c,1e3)).map(f);l(t)}catch(s){s.code==="PGRST205"||s.message?.includes("call_logs")?r("call_logs table does not exist. Please run supabase-call-logs-schema.sql"):(console.error("[useVAPICalls] Error loading from DB:",s),r(s.message||"Failed to refresh calls"))}finally{o(!1),i.current=!1}},[]);return a.useEffect(()=>{if(d()){const s=setTimeout(()=>{n()},2e3),t=setInterval(()=>{n()},300*1e3);return()=>{clearTimeout(s),clearInterval(t)}}},[n]),{calls:e,loading:m,error:g,refreshCalls:n}}export{_ as u};
